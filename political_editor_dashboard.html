<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Political Admin & Editor - EventLens</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <script>tailwind.config = { theme: { extend: { fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] } } } }</script>
  <style>
    body { background: #0f172a; color: #fff; }
    .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
    .sidebar-link { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 12px; transition: all 0.2s; color: #94a3b8; cursor: pointer; }
    .sidebar-link:hover { background: rgba(255,255,255,0.05); color: #fff; }
    .sidebar-link.active { background: linear-gradient(135deg, #f97316, #ea580c); color: white; box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3); }
    .table-row:hover { background: rgba(255,255,255,0.03); }
    
    /* Modal Animation */
    .modal { transition: opacity 0.3s ease-in-out, visibility 0.3s; opacity: 0; visibility: hidden; }
    .modal.open { opacity: 1; visibility: visible; }
    .modal-content { transform: scale(0.95); transition: transform 0.3s; }
    .modal.open .modal-content { transform: scale(1); }

    /* Mobile Preview Container */
    .mobile-frame { border: 8px solid #1e293b; border-radius: 30px; overflow: hidden; height: 640px; width: 340px; position: relative; background: #0f172a; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
    .mobile-screen { height: 100%; width: 100%; overflow-y: auto; background-size: cover; background-position: center; position: relative; }
    .mobile-screen::-webkit-scrollbar { width: 4px; }
    .mobile-screen::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }
    
    .preview-glass { background: rgba(30, 41, 59, 0.85); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; padding: 20px; margin-top: -40px; position: relative; z-index: 10; margin-left: 10px; margin-right: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
    
    .header-bg-preview { height: 160px; width: 100%; background-size: cover; background-position: center; position: relative; }
    .header-overlay { position: absolute; inset: 0; background: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(15, 23, 42, 1)); }
  </style>
</head>
<body class="h-screen flex overflow-hidden">

  <!-- Sidebar -->
  <aside class="w-64 bg-slate-900 border-r border-slate-800 flex flex-col shrink-0">
    <div class="p-6 border-b border-slate-800">
      <div class="flex items-center gap-3 text-orange-500">
        <i class="fa-solid fa-user-shield text-2xl"></i>
        <div>
            <span class="font-bold text-lg text-white block leading-tight">Political Admin</span>
            <span class="text-[10px] text-slate-500" id="sidebarCidDisplay">CID: Loading...</span>
        </div>
      </div>
    </div>
    
    <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
      <div class="px-4 text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2 mt-2">Data Management</div>
      <div class="sidebar-link active" onclick="switchTab('program_info', this)">
        <i class="fa-solid fa-calendar-days w-5"></i> Events
      </div>
      <div class="sidebar-link" onclick="switchTab('coordinator_entry', this)">
        <i class="fa-solid fa-users-gear w-5"></i> Coordinators
      </div>
      <div class="sidebar-link" onclick="switchTab('mandal_reporting', this)">
        <i class="fa-solid fa-clipboard-check w-5"></i> Reporting
      </div>
      <div class="sidebar-link" onclick="switchTab('president_tour', this)">
        <i class="fa-solid fa-plane-departure w-5"></i> President Tour
      </div>

      <div class="px-4 text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2 mt-6">Configuration</div>
      <div class="sidebar-link" onclick="switchTab('settings', this)">
        <i class="fa-solid fa-paintbrush w-5"></i> Branding & Preview
      </div>
    </nav>
    
    <div class="p-4 border-t border-slate-800">
        <button onclick="loadData()" class="w-full bg-slate-800 hover:bg-slate-700 text-orange-400 text-sm font-medium py-2 rounded-lg transition"><i class="fa-solid fa-sync mr-1"></i> Refresh Data</button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 flex flex-col bg-slate-950 relative overflow-hidden">
    <!-- Header -->
    <header class="h-16 border-b border-slate-800 flex items-center justify-between px-8 bg-slate-900/50 backdrop-blur-sm shrink-0">
      <h2 id="pageTitle" class="text-lg font-semibold text-white">Event Details</h2>
      <div class="flex items-center gap-4">
        <div id="cidWarning" class="hidden px-3 py-1 rounded bg-red-500/10 text-red-400 text-xs border border-red-500/20">
            <i class="fa-solid fa-circle-exclamation mr-1"></i> No Collection ID Found
        </div>
        <button onclick="exportCSV()" class="text-slate-400 hover:text-white transition text-sm"><i class="fa-solid fa-download mr-1"></i> Export CSV</button>
      </div>
    </header>

    <!-- Content Area -->
    <div class="flex-1 overflow-hidden relative">
        
        <!-- DATA VIEW (Tables) -->
        <div id="dataView" class="absolute inset-0 p-6 overflow-auto">
            <div class="glass rounded-xl overflow-hidden shadow-2xl">
                <table class="w-full text-left border-collapse">
                <thead class="bg-slate-800 text-slate-400 text-xs uppercase font-semibold">
                    <tr id="tableHeaderRow">
                    <!-- Dynamic Headers -->
                    </tr>
                </thead>
                <tbody id="tableBody" class="text-sm text-slate-300 divide-y divide-slate-800">
                    <tr><td class="p-8 text-center text-slate-500">Loading...</td></tr>
                </tbody>
                </table>
            </div>
        </div>

        <!-- SETTINGS VIEW (Branding) -->
        <div id="settingsView" class="absolute inset-0 p-6 overflow-auto hidden">
            <div class="grid lg:grid-cols-2 gap-8 h-full">
                
                <!-- Left: Controls -->
                <div class="space-y-6 overflow-y-auto pr-2">
                    <!-- Branding Form -->
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-lg font-bold text-white mb-4 border-b border-slate-700 pb-2">App Appearance</h3>
                        <div class="space-y-4">
                            <!-- Logo Upload -->
                            <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1">Organization Logo</label>
                                <div class="flex items-center gap-3">
                                    <div class="h-12 w-12 rounded-full bg-slate-800 border border-slate-700 overflow-hidden flex items-center justify-center">
                                        <img id="logoPreviewSmall" class="h-full w-full object-cover hidden">
                                        <i id="logoPlaceholder" class="fa-solid fa-image text-slate-600"></i>
                                    </div>
                                    <input type="file" id="logoInput" accept="image/*" class="text-xs text-slate-400 file:mr-2 file:py-2 file:px-3 file:rounded-lg file:border-0 file:text-xs file:font-semibold file:bg-slate-800 file:text-orange-400 hover:file:bg-slate-700" onchange="handleImageUpload(this, 'previewLogo', 'logoPreviewSmall')">
                                </div>
                            </div>

                            <!-- Header BG Upload -->
                            <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1">Header Background Image</label>
                                <input type="file" id="headerInput" accept="image/*" class="w-full text-xs text-slate-400 file:mr-2 file:py-2 file:px-3 file:rounded-lg file:border-0 file:text-xs file:font-semibold file:bg-slate-800 file:text-blue-400 hover:file:bg-slate-700" onchange="handleImageUpload(this, 'previewHeaderBg')">
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-medium text-slate-400 mb-1">Org Name</label>
                                    <input type="text" id="brandName" value="EventLens Political" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white outline-none focus:border-orange-500" oninput="updatePreview()">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-slate-400 mb-1">Theme Color</label>
                                    <select id="brandTheme" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white outline-none focus:border-orange-500" onchange="updatePreview()">
                                        <option value="orange">Orange (Saffron)</option>
                                        <option value="blue">Blue (Corporate)</option>
                                        <option value="green">Green (Nature)</option>
                                        <option value="red">Red (Urgent)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-xs font-medium text-slate-400 mb-1">Footer Text</label>
                                <input type="text" id="brandFooter" value="Powered by EventLens" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white outline-none focus:border-orange-500" oninput="updatePreview()">
                            </div>

                            <button onclick="saveSettings()" class="bg-orange-600 hover:bg-orange-500 text-white px-4 py-2 rounded-lg text-sm font-medium transition w-full mt-2">Save Configuration</button>
                        </div>
                    </div>

                    <!-- Links Generator -->
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-lg font-bold text-white mb-4 border-b border-slate-700 pb-2">Form Links</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center p-2 hover:bg-slate-800 rounded transition">
                                <span class="text-sm text-slate-300"><i class="fa-solid fa-calendar-days w-6 text-center"></i> Event Details</span>
                                <button onclick="copyLink('political_program_info_form.html')" class="text-xs bg-slate-700 px-2 py-1 rounded text-white">Copy Link</button>
                            </div>
                            <div class="flex justify-between items-center p-2 hover:bg-slate-800 rounded transition">
                                <span class="text-sm text-slate-300"><i class="fa-solid fa-users-gear w-6 text-center"></i> Coordinator</span>
                                <button onclick="copyLink('political_coordinator_entry_form.html')" class="text-xs bg-slate-700 px-2 py-1 rounded text-white">Copy Link</button>
                            </div>
                            <div class="flex justify-between items-center p-2 hover:bg-slate-800 rounded transition">
                                <span class="text-sm text-slate-300"><i class="fa-solid fa-clipboard-check w-6 text-center"></i> Reporting</span>
                                <button onclick="copyLink('political_mandal_reporting_form.html')" class="text-xs bg-slate-700 px-2 py-1 rounded text-white">Copy Link</button>
                            </div>
                            <div class="flex justify-between items-center p-2 hover:bg-slate-800 rounded transition">
                                <span class="text-sm text-slate-300"><i class="fa-solid fa-plane-departure w-6 text-center"></i> President Tour</span>
                                <button onclick="copyLink('political_president_tour_form.html')" class="text-xs bg-slate-700 px-2 py-1 rounded text-white">Copy Link</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right: Preview -->
                <div class="flex flex-col items-center justify-start h-full">
                    <div class="w-full flex justify-between items-center mb-4 px-2">
                        <div class="text-slate-400 text-xs uppercase tracking-widest font-semibold">Live Preview</div>
                        <select id="previewFormSelector" onchange="updatePreview()" class="bg-slate-800 text-white text-xs border border-slate-700 rounded px-2 py-1 outline-none focus:border-orange-500">
                            <option value="program_info">Event Details Form</option>
                            <option value="coordinator_entry">Coordinator Form</option>
                            <option value="mandal_reporting">Reporting Form</option>
                            <option value="president_tour">President Tour Form</option>
                        </select>
                    </div>
                    
                    <div class="mobile-frame shadow-2xl relative">
                        <!-- Simulated Mobile Screen -->
                        <div class="mobile-screen" id="mobileScreen">
                            
                            <!-- Header BG -->
                            <div id="previewHeaderBg" class="header-bg-preview" style="background-image: url('https://images.unsplash.com/photo-1557683316-973673baf926?q=80&w=1000&auto=format&fit=crop');">
                                <div class="header-overlay"></div>
                            </div>

                            <!-- Main Card -->
                            <div class="preview-glass">
                                <!-- Logo & Title -->
                                <div class="text-center mb-6">
                                    <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-slate-800 border border-slate-700 mb-3 overflow-hidden shadow-lg relative -mt-12 z-20">
                                        <img id="previewLogo" src="https://cdn-icons-png.flaticon.com/512/9313/9313234.png" class="w-full h-full object-cover">
                                    </div>
                                    <h1 id="prevHeader" class="text-xl font-bold text-white">EventLens Political</h1>
                                    <p id="prevSubHeader" class="text-slate-400 text-xs mt-1">Form Name Here</p>
                                </div>

                                <!-- Dynamic Form Fields (Preview) -->
                                <div id="previewFields" class="space-y-3">
                                    <!-- Populated by JS -->
                                </div>

                                <!-- Button -->
                                <div id="prevBtn" class="h-12 bg-gradient-to-r rounded-xl w-full mt-5 shadow-lg flex items-center justify-center text-white font-bold text-sm">
                                    Submit
                                </div>
                            </div>

                            <div id="prevFooter" class="text-[10px] text-slate-500 text-center mt-6 pb-4">Powered by EventLens</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>
  </main>

  <!-- Edit Modal -->
  <div id="editModal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4">
    <div class="modal-content glass w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
      <div class="p-5 border-b border-slate-700 flex justify-between items-center bg-slate-800/50">
        <h3 class="font-bold text-lg text-white">Edit Entry</h3>
        <button onclick="closeModal()" class="text-slate-400 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
      </div>
      <div class="p-6 overflow-y-auto space-y-4" id="modalForm"></div>
      <div class="p-5 border-t border-slate-700 bg-slate-800/50 flex justify-end gap-3">
        <button onclick="closeModal()" class="px-5 py-2 rounded-lg text-slate-300 hover:bg-slate-700 transition">Cancel</button>
        <button onclick="saveChanges()" class="px-5 py-2 rounded-lg bg-orange-600 hover:bg-orange-500 text-white font-medium shadow-lg shadow-orange-500/20 transition">Save Changes</button>
      </div>
    </div>
  </div>

  <script>
    const API_ID = 'vxid0yoovj';
    const REGION = 'ap-south-1';
    let currentTab = 'program_info';
    let currentData = [];
    let editingId = null;
    let collectionId = '';

    const qs = (name) => (new URL(window.location.href)).searchParams.get(name) || '';
    collectionId = qs('cid') || qs('collection_id');

    if(!collectionId) {
        document.getElementById('cidWarning').classList.remove('hidden');
        document.getElementById('sidebarCidDisplay').textContent = "CID: MISSING (Check URL)";
        document.getElementById('tableBody').innerHTML = `<tr><td colspan="5" class="p-8 text-center text-red-400">Error: No Collection ID found in URL.<br>Please use ?cid=YOUR_ID</td></tr>`;
    } else {
        document.getElementById('sidebarCidDisplay').textContent = `CID: ${collectionId.substring(0,8)}...`;
        loadData();
    }

    const SCHEMAS = {
      'program_info': {
        title: 'Event Details',
        headers: ['Program', 'Date/Time', 'Location', 'Action'],
        fields: [
            { key: 'program_name', label: 'Name' }, { key: 'program_time', label: 'Time', type: 'datetime-local' },
            { key: 'district', label: 'District' }, { key: 'program_location', label: 'Location' }
        ],
        previewFields: [
            { icon: 'fa-user', ph: 'Coordinator Name' }, { icon: 'fa-heading', ph: 'Program Title' },
            { icon: 'fa-map-location-dot', ph: 'District' }, { icon: 'fa-map-pin', ph: 'Location' },
            { icon: 'fa-calendar-day', ph: 'Date & Time' }
        ]
      },
      'coordinator_entry': {
        title: 'Coordinator Form',
        headers: ['Name', 'Role', 'Mobile', 'Action'],
        fields: [
            { key: 'convenor_name', label: 'Name' }, { key: 'coordinator_role', label: 'Role' },
            { key: 'convenor_mobile', label: 'Mobile' }, { key: 'area', label: 'Area' }
        ],
        previewFields: [
            { icon: 'fa-bullhorn', ph: 'Program Name' }, { icon: 'fa-map-location-dot', ph: 'District' },
            { icon: 'fa-user', ph: 'Convenor Name' }, { icon: 'fa-phone', ph: 'Convenor Mobile' },
            { icon: 'fa-user-plus', ph: 'Co-Convenor 1' }, { icon: 'fa-user-plus', ph: 'Co-Convenor 2' }
        ]
      },
      'mandal_reporting': {
        title: 'Mandal Reporting',
        headers: ['Program', 'Level', 'Attendance', 'Action'],
        fields: [
            { key: 'program_name', label: 'Program' }, { key: 'report_level', label: 'Level', type: 'select', options:['mandal','district','vidhansabha'] },
            { key: 'total_attendance', label: 'Attendance' }
        ],
        previewFields: [
            { icon: 'fa-heading', ph: 'Program Name' }, { icon: 'fa-layer-group', ph: 'Level (Mandal/Dist)' },
            { icon: 'fa-map-location-dot', ph: 'Location Info' }, { icon: 'fa-users', ph: 'Total Attendance' },
            { icon: 'fa-camera', ph: 'Upload Photos (Box)' }
        ]
      },
      'president_tour': {
        title: 'President Tour',
        headers: ['Tour Place', 'Date', 'VIP', 'Action'],
        fields: [
            { key: 'tour_place', label: 'Place' }, { key: 'tour_date', label: 'Date', type: 'date' },
            { key: 'vip_person', label: 'VIP' }
        ],
        previewFields: [
            { icon: 'fa-user', ph: 'Your Name' }, { icon: 'fa-calendar-day', ph: 'Tour Date' },
            { icon: 'fa-location-arrow', ph: 'Tour Place' }, { icon: 'fa-user-tie', ph: 'VIP Name' },
            { icon: 'fa-camera', ph: 'Event Photos' }
        ]
      }
    };

    function switchTab(tab, el) {
      currentTab = tab;
      document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
      el.classList.add('active');
      
      const titles = { 'program_info': 'Event Details', 'coordinator_entry': 'Coordinator Management', 'mandal_reporting': 'Mandal Reports', 'president_tour': 'President Tour Logs', 'settings': 'Dashboard Settings' };
      document.getElementById('pageTitle').textContent = titles[tab];

      if(tab === 'settings') {
        document.getElementById('dataView').classList.add('hidden');
        document.getElementById('settingsView').classList.remove('hidden');
        updatePreview();
      } else {
        document.getElementById('settingsView').classList.add('hidden');
        document.getElementById('dataView').classList.remove('hidden');
        loadData();
      }
    }

    // --- Image Upload & Preview Logic ---
    function handleImageUpload(input, targetImgId, smallPreviewId = null) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById(targetImgId);
                
                // If it's a background div (header)
                if(targetImgId === 'previewHeaderBg') {
                    img.style.backgroundImage = `url('${e.target.result}')`;
                } else {
                    // Normal IMG tag
                    img.src = e.target.result;
                }

                if (smallPreviewId) {
                    const small = document.getElementById(smallPreviewId);
                    small.src = e.target.result;
                    small.classList.remove('hidden');
                    document.getElementById('logoPlaceholder').classList.add('hidden');
                }
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    function updatePreview() {
        const name = document.getElementById('brandName').value;
        const footer = document.getElementById('brandFooter').value;
        const theme = document.getElementById('brandTheme').value;
        const selectedForm = document.getElementById('previewFormSelector').value;

        // Texts
        document.getElementById('prevHeader').textContent = name;
        document.getElementById('prevFooter').textContent = footer;
        document.getElementById('prevSubHeader').textContent = SCHEMAS[selectedForm].title;

        // Theme Colors
        const btn = document.getElementById('prevBtn');
        const screen = document.getElementById('mobileScreen');
        let bgGrad, btnGrad, focusColor;

        if(theme === 'blue') {
            bgGrad = 'radial-gradient(circle at top left, rgba(59,130,246,0.15), transparent 50%), #0f172a';
            btnGrad = 'from-blue-600 to-indigo-600';
            focusColor = 'border-blue-500';
        } else if(theme === 'green') {
            bgGrad = 'radial-gradient(circle at top left, rgba(16,185,129,0.15), transparent 50%), #0f172a';
            btnGrad = 'from-emerald-600 to-teal-600';
            focusColor = 'border-emerald-500';
        } else if(theme === 'red') {
            bgGrad = 'radial-gradient(circle at top left, rgba(239,68,68,0.15), transparent 50%), #0f172a';
            btnGrad = 'from-red-600 to-rose-600';
            focusColor = 'border-red-500';
        } else { // Orange
            bgGrad = 'radial-gradient(circle at top left, rgba(249,115,22,0.15), transparent 50%), #0f172a';
            btnGrad = 'from-orange-500 to-red-500';
            focusColor = 'border-orange-500';
        }

        screen.style.background = bgGrad;
        btn.className = `h-12 bg-gradient-to-r rounded-xl w-full mt-5 shadow-lg flex items-center justify-center text-white font-bold text-sm ${btnGrad}`;

        // Render Form Fields
        const fieldsContainer = document.getElementById('previewFields');
        fieldsContainer.innerHTML = '';
        const previewSchema = SCHEMAS[selectedForm].previewFields || [];

        previewSchema.forEach(f => {
            let innerContent = '';
            if(f.icon === 'fa-camera') {
                innerContent = `
                <div class="border-2 border-dashed border-slate-600/50 rounded-xl h-24 flex flex-col items-center justify-center bg-slate-800/30">
                    <i class="fa-solid fa-camera text-slate-500 mb-1"></i>
                    <span class="text-[10px] text-slate-500">${f.ph}</span>
                </div>`;
            } else {
                innerContent = `
                <div class="relative">
                    <input disabled type="text" placeholder="${f.ph}" class="w-full bg-slate-900/60 border border-slate-700/50 rounded-lg py-3 pl-10 pr-3 text-xs text-slate-400">
                    <i class="fa-solid ${f.icon} absolute left-3 top-3.5 text-slate-500 text-xs"></i>
                </div>`;
            }
            fieldsContainer.innerHTML += innerContent;
        });
    }

    // --- Standard Data Functions (Mock) ---
    async function loadData() {
      if(!collectionId) return;
      const tbody = document.getElementById('tableBody');
      const thead = document.getElementById('tableHeaderRow');
      const schema = SCHEMAS[currentTab];
      thead.innerHTML = schema.headers.map(h => `<th class="p-4 border-b border-slate-700">${h}</th>`).join('');
      tbody.innerHTML = `<tr><td colspan="${schema.headers.length}" class="p-8 text-center text-slate-400"><i class="fa-solid fa-spinner fa-spin text-2xl mb-2"></i><br>Loading Data...</td></tr>`;

      try {
        await new Promise(r => setTimeout(r, 600)); 
        const mockData = Array.from({length: 5}).map((_,i) => ({
            entry_id: `id_${Math.random().toString(36).substr(2,5)}`,
            payload: { program_name: `Event ${i+1}`, program_time: '2025-10-10T10:00', district: 'Indore', program_location: 'Hall A', convenor_name: 'Rahul Singh', coordinator_role: 'Adhyaksh', convenor_mobile: '9998887776', area: 'Ward 5', report_level: 'mandal', total_attendance: 150 + (i*10), tour_place: 'Bhopal', tour_date: '2025-11-01', vip_person: 'President' }
        }));
        renderTable(mockData);
      } catch(err) { tbody.innerHTML = `<tr><td colspan="${schema.headers.length}" class="p-8 text-center text-red-400">Error: ${err.message}</td></tr>`; }
    }

    function renderTable(data) {
        currentData = data;
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';
        const schema = SCHEMAS[currentTab];
        data.forEach(item => {
            const d = item.payload || {};
            let tds = '';
            schema.fields.forEach(f => { tds += `<td class="p-4 text-slate-300">${d[f.key] || '-'}</td>`; });
            tbody.innerHTML += `<tr class="table-row border-b border-slate-800/50 transition">${tds}<td class="p-4 text-right"><button onclick="openEdit('${item.entry_id}')" class="text-orange-400 bg-orange-500/10 px-3 py-1.5 rounded-lg text-xs font-medium">Edit</button></td></tr>`;
        });
    }

    function openEdit(id) {
        const item = currentData.find(i => i.entry_id === id); if(!item) return; editingId = id;
        const formContainer = document.getElementById('modalForm'); formContainer.innerHTML = '';
        const fields = SCHEMAS[currentTab].fields || []; const data = item.payload || {};
        fields.forEach(field => {
            const val = data[field.key] || '';
            let inputHtml = `<input type="${field.type || 'text'}" id="edit_${field.key}" value="${val}" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2.5 text-white outline-none" />`;
            if(field.type === 'select') inputHtml = `<select id="edit_${field.key}" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2.5 text-white">${field.options.map(o => `<option value="${o}" ${o===val?'selected':''}>${o}</option>`).join('')}</select>`;
            formContainer.innerHTML += `<div><label class="block text-xs font-medium text-slate-400 mb-1.5 uppercase">${field.label}</label>${inputHtml}</div>`;
        });
        document.getElementById('editModal').classList.add('open');
    }

    function closeModal() { document.getElementById('editModal').classList.remove('open'); }
    function saveChanges() { closeModal(); alert("Changes Saved (Mock Mode)"); }
    function saveSettings() { alert("Settings Saved! This branding will apply to public forms."); }
    function copyLink(filename) {
        if(!collectionId) { alert("Collection ID Missing!"); return; }
        const base = window.location.href.substring(0, window.location.href.lastIndexOf('/'));
        const link = `${base}/${filename}?cid=${collectionId}`;
        navigator.clipboard.writeText(link);
        alert("Link Copied: " + link);
    }
    
    // Initial Render
    updatePreview();
  </script>
</body>
</html>
