<!DOCTYPE html>

<!-- EventLens build: 2026-02-17 04:08:31 -->
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Program Info - EventLens</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // === EventLens Admin Console Live Preview Bridge (2026-02-17) ===
    (function() {
      const __ft = (typeof FORM_TYPE !== "undefined") ? FORM_TYPE : ((typeof FORM_TYPE_RAW !== "undefined") ? FORM_TYPE_RAW : "");
      const __cid = (qs("cid") || qs("collection_id") || qs("cid") || "").trim();

      function __applyPreview(payload) {
        try {
          const fb = window.__EL_PREVIEW_FALLBACKS || {};
          applyBrandingFromConfig(payload, __ft, fb.title || "", fb.subtitle || "", fb.tagline || "", fb.iconId || "default-icon");

          // Keep tagline visibility consistent
          const tg = document.getElementById("org-tagline");
          if (tg) {
            if ((tg.textContent || "").trim()) tg.classList.remove("hidden");
            else tg.classList.add("hidden");
          }
        } catch(e) {}
      }

      window.addEventListener("message", (ev) => {
        const d = ev && ev.data;
        if (!d || typeof d !== "object") return;
        if (d.type !== "EL_PREVIEW_SETTINGS") return;
        if (d.form_type && __ft && d.form_type !== __ft) return;
        if (d.cid && __cid && d.cid !== __cid) return;
        __applyPreview(d.payload || {});
      });

      try {
        if (window.parent && window.parent !== window) {
          window.parent.postMessage({ type: "EL_PREVIEW_READY", cid: __cid, form_type: __ft }, "*");
        }
      } catch(e) {}

      window.__EL_applyPreviewSettings = __applyPreview;
    })();
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] }
        }
      }
    }
  </script>
  <style>
    :root {
      --c1: #f97316; /* primary */
      --c2: #ef4444; /* secondary */
      --bgimg: none;
    }
    body {
      background:
        radial-gradient(circle at top left, rgba(249, 115, 22, 0.14), transparent 50%),
        radial-gradient(circle at bottom right, rgba(234, 88, 12, 0.10), transparent 50%),
        linear-gradient(180deg, rgba(2, 6, 23, 0.92), rgba(2, 6, 23, 0.98)),
        var(--bgimg);
      background-size: cover;
      background-attachment: fixed;
      color: #fff;
    }
    .glass {
      background: rgba(30, 41, 59, 0.75);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.10);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.40);
    }
    .input-field {
      background: rgba(15, 23, 42, 0.55);
      border: 1px solid rgba(255, 255, 255, 0.10);
      color: white;
      transition: all 0.25s ease;
    }
    .input-field:focus {
      border-color: var(--c1);
      box-shadow: 0 0 0 2px rgba(249, 115, 22, 0.18);
      outline: none;
    }
    .input-field:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      background: rgba(15, 23, 42, 0.35);
    }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #0f172a; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }

    .brand-text {
      background-clip: text;
      -webkit-background-clip: text;
      color: transparent;
      background-image: linear-gradient(to right, var(--c1), var(--c2));
    }
    .brand-bg { background-image: linear-gradient(to right, var(--c1), var(--c2)); }
    .brand-ring { box-shadow: 0 0 0 2px rgba(249, 115, 22, 0.16); }
  

    /* === EventLens Embed/Light/Preview Patch (2026-02-17) === */
    html, body { height: 100%; }
    body.el-embed {
      margin: 0 !important;
      padding: 0 !important;
      overflow-x: hidden;
      background-attachment: scroll !important;
    }
    body.el-embed [class*="max-w-"] {
      max-width: 100% !important;
    }
    body.el-embed img {
      max-width: 100% !important;
      height: auto !important;
    }
    /* Light mode (optional via ?theme=light) */
    body.el-light {
      color: #0f172a !important;
      background: #f8fafc !important;
    }
    body.el-light .glass {
      background: rgba(255, 255, 255, 0.88) !important;
      border: 1px solid rgba(15, 23, 42, 0.10) !important;
      box-shadow: 0 14px 28px rgba(2, 6, 23, 0.10) !important;
    }
    body.el-light .input-field {
      background: rgba(255, 255, 255, 0.96) !important;
      color: #0f172a !important;
      border: 1px solid rgba(15, 23, 42, 0.18) !important;
    }
    body.el-light .input-field::placeholder {
      color: rgba(15, 23, 42, 0.45) !important;
    }


/* ===== EventLens: Light mode visibility fixes (auto) ===== */
body.mode-light{ color:#0f172a !important; }
body.mode-light .card,
body.mode-light .panel,
body.mode-light .section,
body.mode-light .container,
body.mode-light .wrap,
body.mode-light .box{
  background: rgba(255,255,255,.92) !important;
  border-color: rgba(15,23,42,.14) !important;
}
body.mode-light input,
body.mode-light select,
body.mode-light textarea{
  background: rgba(255,255,255,.96) !important;
  color:#0f172a !important;
  border-color: rgba(15,23,42,.18) !important;
}
body.mode-light input::placeholder,
body.mode-light textarea::placeholder{
  color: rgba(15,23,42,.45) !important;
}
body.mode-light label,
body.mode-light .label{ color: rgba(15,23,42,.85) !important; }
body.mode-light .muted,
body.mode-light .hint,
body.mode-light .help{ color: rgba(15,23,42,.65) !important; }
body.mode-light select option{ background:#ffffff; color:#0f172a; }
/* ===== /EventLens: Light mode visibility fixes ===== */
</style>
<script>
/* ‚îÄ‚îÄ Universal Branding v3 ‚îÄ‚îÄ */
function _elPickUrl(obj){
  if(!obj) return "";
  if(typeof obj==="string") return obj;
  return obj.url||obj.src||obj.href||"";
}
function _elApplyBg(url){
  if(!url) return;
  const img=new Image();
  img.onload=function(){
    document.documentElement.style.setProperty("--bgimg","url('"+url+"')");
    document.body.classList.add("has-brand-bg");
    document.body.style.backgroundImage="url('"+url+"')";
    document.body.style.backgroundSize="cover";
    document.body.style.backgroundAttachment="fixed";
    document.body.style.backgroundPosition="center";
  };
  img.src=url;
}
function _elApplyBranding(res, FTYPE){
  try{
    const cfg=res.config||res.settings||res.data||res||{};
    const forms=cfg.forms||{};
    const ft=forms[FTYPE]||forms[(FTYPE||"").replace("political_","")]||{};
    const def=(cfg.defaults&&cfg.defaults.branding)||cfg.branding||cfg.defaults||{};
    const gl=cfg.global||{};
    const br=ft.branding||{};

    const title=ft.title||br.title||def.title||gl.title||"";
    const sub=ft.subtitle||br.subtitle||def.subtitle||"";
    const tagline=ft.tagline||br.tagline||gl.tagline||"Powered by EventLens";
    const c1=br.color1||br.primary_color||def.color1||def.primary||gl.theme?.primary||"";
    const c2=br.color2||br.secondary_color||def.color2||def.secondary||gl.theme?.secondary||"";

    const logoUrl=_elPickUrl(br.logo)||ft.logo_url||def.logo_url||"";
    const hdrUrl=_elPickUrl(br.header)||ft.header_url||def.header_url||"";
    const bgUrl=_elPickUrl(br.background)||ft.background_url||def.background_url||"";

    // Apply colors
    if(c1){ document.documentElement.style.setProperty("--o1",c1); document.documentElement.style.setProperty("--c1",c1); document.documentElement.style.setProperty("--saf",c1); }
    if(c2){ document.documentElement.style.setProperty("--o2",c2); document.documentElement.style.setProperty("--c2",c2); document.documentElement.style.setProperty("--saf2",c2); }

    // Title/subtitle
    const n=document.getElementById("org-name")||document.getElementById("org-title");
    if(n&&title) n.textContent=title;
    const s=document.getElementById("org-sub")||document.getElementById("org-subtitle");
    if(s&&sub) s.textContent=sub;
    const tg=document.getElementById("org-tagline");
    if(tg){ if(tagline){tg.textContent=tagline;tg.style.display="";} }
    ["footer-cam","footer-form","footer-text"].forEach(id=>{
      const el=document.getElementById(id); if(el&&tagline) el.textContent=tagline;
    });
    document.title=(title||"EventLens")+" - EventLens";

    // Logo
    if(logoUrl){
      ["logo-img","custom-logo"].forEach(id=>{
        const el=document.getElementById(id);
        if(el){ el.src=logoUrl; el.style.display="block"; el.onerror=()=>{ el.style.display="none"; }; }
      });
      ["default-icon","logo-default"].forEach(id=>{
        const el=document.getElementById(id); if(el) el.style.display="none";
      });
    }

    // Header image
    if(hdrUrl){
      ["brand-header-img","hdr-cam-img","form-hdr-img"].forEach(id=>{
        const el=document.getElementById(id);
        if(el){ el.src=hdrUrl+"?t="+Date.now(); el.style.display="block"; el.onerror=()=>{ el.style.display="none"; }; }
      });
      ["hdr-cam-img-wrap","form-hdr-img-wrap"].forEach(id=>{
        const el=document.getElementById(id); if(el) el.style.display="block";
      });
    }

    // Background image
    _elApplyBg(bgUrl);

    // Program options
    _elFillProgramOptions(ft, cfg);

  }catch(e){ console.warn("EL branding error",e); }
}

function _elFillProgramOptions(ft, cfg){
  try{
    // program_type select
    const sel=document.getElementById("program_type")||document.getElementById("f-program");
    if(sel){
      const opts=ft.program_options||(cfg.defaults&&cfg.defaults.program_options)||[];
      if(Array.isArray(opts)&&opts.length){
        const cur=sel.value;
        sel.innerHTML='<option value="">‚Äî ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç ‚Äî</option>';
        opts.forEach(o=>{
          const v=(typeof o==="string")?o:(o.value||o.label||o.name||String(o));
          const op=document.createElement("option");
          op.value=v; op.textContent=v;
          if(v===cur) op.selected=true;
          sel.appendChild(op);
        });
      }
    }
    // fixed_level
    const fl=ft.fixed_level||(cfg.defaults&&cfg.defaults.fixed_level)||"";
    if(fl){
      ["program_level","f-level"].forEach(id=>{
        const el=document.getElementById(id);
        if(el){ el.value=fl; el.disabled=true; }
      });
    }
  }catch(e){}
}

async function _elLoadBranding(BASE_URL, FTYPE, TOKEN, CID){
  try{
    const payload=TOKEN?{token:TOKEN,form_type:FTYPE}:{collection_id:CID,form_type:FTYPE};
    const action=TOKEN?"public_get_config":"admin_get_config";
    const r=await fetch(BASE_URL,{
      method:"POST", cache:"no-store",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({action,payload})
    });
    const res=await r.json();
    if(!window._EL_CID && res.cid) window._EL_CID=res.cid;
    _elApplyBranding(res, FTYPE);
    return res;
  }catch(e){ console.warn("EL loadBranding failed",e); return {}; }
}
/* ‚îÄ‚îÄ End Universal Branding ‚îÄ‚îÄ */
</script>

<style>
/* ‚îÄ‚îÄ Mobile Responsive Fixes ‚îÄ‚îÄ */
html,body{overflow-x:hidden;-webkit-text-size-adjust:100%;}
body.has-brand-bg{background-size:cover!important;background-attachment:fixed!important;}
@media(max-width:600px){
  .container,.wrap,.card,.form-card,.scr,.main-card{max-width:100vw!important;width:100%!important;padding:12px!important;border-radius:14px!important;}
  input,select,textarea{font-size:16px!important;} /* Prevent iOS zoom */
  .btn,.btn-primary,.btn-ghost,.submit-btn{width:100%!important;padding:14px!important;font-size:16px!important;}
  #cam-box,#cam-wrap{max-height:60vw!important;}
  .step-row,.steps,.nav-dots{flex-wrap:wrap!important;}
  #logo-img,#custom-logo{max-width:40px!important;max-height:40px!important;}
  #brand-header-img,#hdr-cam-img,#form-hdr-img{max-height:140px!important;object-fit:cover!important;}
  h1,h2{font-size:18px!important;} h3{font-size:15px!important;}
  .timeline-card,.event-card,.result-card{padding:10px!important;}
}
@media(max-width:400px){
  .container,.wrap,.card{padding:8px!important;}
  h1,h2{font-size:16px!important;}
}
</style>

<meta name="mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="apple-mobile-web-app-title" content="EventLens"/>
<meta name="theme-color" content="#f97316"/>
<link rel="manifest" href="/manifest.json"/>
</head>
    <body class="min-h-screen flex items-center justify-center p-4 font-sans mode-dark">

    <div class="w-full max-w-lg glass rounded-2xl p-6 relative overflow-hidden transition-all duration-500" id="main-container">
    <div class="absolute top-0 left-0 w-full h-1 brand-bg"></div>

    <div id="header-image" class="hidden w-full h-24 rounded-xl mb-4 bg-slate-800/40 border border-white/5 overflow-hidden bg-cover bg-center"></div>

    <div class="text-center mb-6" id="form-header">
        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-white/5 text-orange-500 mb-3 overflow-hidden border border-white/10">
            <i id="default-icon" class="fa-solid fa-circle-info text-2xl"></i>
            <img id="custom-logo" src="" class="w-full h-full object-cover hidden" alt="logo">
        </div>
        <h1 id="org-name" class="text-2xl font-extrabold brand-text">‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§á‡§®‡•ç‡§´‡•ã</h1>
        <p id="org-subtitle" class="text-slate-300/80 text-xs mt-1">Program Information</p>
        <p id="org-tagline" class="text-slate-400 text-[11px] mt-2 hidden"></p>
    </div>

      <form id="f" class="space-y-4">

        <div>
          <label class="block text-xs font-medium text-slate-300/80 mb-1">Level</label>
          <div class="relative">
            <select id="level" class="w-full rounded-lg px-3 py-2.5 text-sm input-field appearance-none">
              <option value="district">District</option>
              <option value="vidhansabha">Vidhan Sabha</option>
              <option value="mandal" selected>Mandal</option>
            </select>
            <i class="fa-solid fa-chevron-down absolute right-3 top-3.5 text-slate-500 text-xs pointer-events-none"></i>
          </div>
          <p id="level-note" class="text-[10px] text-slate-400 mt-1"></p>
        </div>

        <div>
          <label class="block text-xs font-medium text-slate-300/80 mb-1">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
          <div class="relative">
            <select id="program_name" class="w-full rounded-lg px-3 py-2.5 text-sm input-field appearance-none" required>
              <option value="">‚Äî ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ö‡•Å‡§®‡•á‡§Ç ‚Äî</option>
              <option value="‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ-1">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ-1</option>
            </select>
            <i class="fa-solid fa-chevron-down absolute right-3 top-3.5 text-slate-500 text-xs pointer-events-none"></i>
          </div>
        </div>

        <div id="wrap-district">
          <label class="block text-xs font-medium text-slate-300/80 mb-1">‡§ú‡§ø‡§≤‡§æ</label>
          <select id="district" class="w-full rounded-lg px-3 py-2.5 text-sm input-field">
            <option value="">‚Äî ‡§ú‡§ø‡§≤‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç ‚Äî</option>
          </select>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div id="wrap-vidhansabha">
            <label class="block text-xs font-medium text-slate-300/80 mb-1">‡§µ‡§ø‡§ß‡§æ‡§®‡§∏‡§≠‡§æ</label>
            <select id="vidhansabha" class="w-full rounded-lg px-3 py-2.5 text-sm input-field" disabled>
              <option value="">‚Äî ‡§™‡§π‡§≤‡•á ‡§ú‡§ø‡§≤‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç ‚Äî</option>
            </select>
          </div>
          <div id="wrap-mandal">
            <label class="block text-xs font-medium text-slate-300/80 mb-1">‡§Æ‡§Ç‡§°‡§≤</label>
            <select id="mandal" class="w-full rounded-lg px-3 py-2.5 text-sm input-field" disabled>
              <option value="">‚Äî ‡§™‡§π‡§≤‡•á ‡§µ‡§ø‡§ß‡§æ‡§®‡§∏‡§≠‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç ‚Äî</option>
            </select>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-xs font-medium text-slate-300/80 mb-1">‡§§‡§æ‡§∞‡•Ä‡§ñ</label>
            <input type="date" id="program_date" class="w-full rounded-lg px-3 py-2.5 text-sm input-field" required>
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-300/80 mb-1">‡§∏‡§Æ‡§Ø</label>
            <input type="time" id="program_time" class="w-full rounded-lg px-3 py-2.5 text-sm input-field">
          </div>
        </div>

        <div>
          <label class="block text-xs font-medium text-slate-300/80 mb-1">‡§∏‡•ç‡§•‡§æ‡§® / Venue</label>
          <input type="text" id="venue" class="w-full rounded-lg px-3 py-2.5 text-sm input-field" placeholder="Venue" required>
        </div>

        <div>
          <label class="block text-xs font-medium text-slate-300/80 mb-1">‡§µ‡§ø‡§µ‡§∞‡§£</label>
          <textarea id="details" rows="4" class="w-full rounded-lg px-3 py-2.5 text-sm input-field" placeholder="Program details" required></textarea>
        </div>

        <!-- Photo upload removed as per requirements -->

        <button type="submit" id="submitBtn" class="w-full brand-bg text-white font-extrabold py-3 rounded-xl shadow-lg shadow-orange-500/20 transition-all active:scale-[0.98] flex items-center justify-center gap-2 hover:opacity-95">
          <span>‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç (Save)</span><i class="fa-solid fa-paper-plane text-xs"></i>
        </button>
      </form>

    <div id="status" class="mt-4 text-center text-xs font-medium hidden"></div>
    <div class="mt-4 text-center text-[11px] text-slate-400/80">
      <span id="footer-text"></span>
    </div>
</div>

    <!-- SUCCESS SCREEN -->
<div id="success-screen" class="hidden w-full max-w-lg glass rounded-2xl p-8 text-center flex flex-col items-center justify-center min-h-[420px]">
    <div class="w-20 h-20 bg-emerald-500/15 text-emerald-400 rounded-full flex items-center justify-center mb-6 text-4xl shadow-lg shadow-emerald-500/10 border border-emerald-500/20">
        <i class="fa-solid fa-check"></i>
    </div>
    <h2 class="text-2xl font-extrabold text-white mb-2">‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!</h2>
    <p id="success-msg" class="text-slate-200/90 mb-8 leading-relaxed">‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§á‡§®‡•ç‡§´‡•ã ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§à ‡§π‡•à‡•§</p>
    <button onclick="window.location.reload()" class="px-6 py-2.5 bg-white/10 hover:bg-white/15 border border-white/10 rounded-lg text-sm text-white transition">
        <i class="fa-solid fa-rotate-right mr-2"></i> ‡§®‡§Ø‡§æ ‡§´‡•â‡§∞‡•ç‡§Æ
    </button>
</div>

    <script>
    // ===============================
// COMMON CONFIG & UTILS
// ===============================
const API_ID = "vxid0yoovj";
const AWS_REGION = "ap-south-1";
const BASE_URL = "https://" + API_ID + ".execute-api." + AWS_REGION + ".amazonaws.com/prod";

const $ = (id) => document.getElementById(id);
const qs = (n) => { try { return (new URL(window.location.href)).searchParams.get(n) || ""; } catch (e) { return ""; } };

  // === Embed / Preview flags (2026-02-17) ===
  const __EL_PREVIEW_MODE = (qs("preview") === "1");
  const __EL_EMBED_MODE = (qs("embed") === "1") || (window.self !== window.top);
  const __EL_THEME_MODE = (qs("theme") || "").toLowerCase();
  try {
    if (__EL_EMBED_MODE) document.body.classList.add("el-embed");
    if (__EL_PREVIEW_MODE) document.body.classList.add("el-preview");
    if (__EL_THEME_MODE === "light") document.body.classList.add("el-light");
  } catch(e) {}


const token = (qs("token") || "").trim();
const cidParam = (qs("cid") || qs("collection_id") || qs("id") || "").trim();
const levelParam = (qs("level") || "").trim().toLowerCase(); // district | vidhansabha | mandal
const debug = (qs("debug") || "").trim() === "1";

function isPublicMode() { return !!token; }

function setThemeVars(c1, c2) {
  if (c1) document.documentElement.style.setProperty("--c1", c1);
  if (c2) document.documentElement.style.setProperty("--c2", c2);
}
function setBackgroundImage(url) {
  if (!url) return;
  document.documentElement.style.setProperty("--bgimg", "url('" + url + "')");
}

function showStatus(msg, isError) {
  const el = $("status");
  if (!el) return;
  el.classList.remove("hidden","text-green-400","text-red-400");
  el.classList.add(isError ? "text-red-400" : "text-green-400");
  el.textContent = msg || "";
  if (!msg) el.classList.add("hidden");
}

async function apiCall(action, payload) {
  const path = isPublicMode() ? "/political/public/forms" : "/political/forms";
  const url = BASE_URL + path;
  const res = await fetch(url, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ action, payload: payload || {} })
  });
  const text = await res.text();
  let data = {};
  try { data = JSON.parse(text); } catch(e) { data = { message: text || "Invalid JSON" }; }
  if (!res.ok) throw new Error(data.message || data.error || ("HTTP " + res.status));
  return data;
}

function safeStr(v) { return (v === null || v === undefined) ? "" : String(v); }

async function sha256Hex(file) {
  const buffer = await file.arrayBuffer();
  const hashBuffer = await crypto.subtle.digest("SHA-256", buffer);
  return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2,'0')).join('');
}

async function uploadToS3(url, file) {
  await fetch(url, { method: "PUT", body: file, headers: { "Content-Type": file.type || "application/octet-stream" } });
}

function mergeObj(a, b) {
  const out = Object.assign({}, a || {});
  Object.keys(b || {}).forEach(k => {
    if (b[k] && typeof b[k] === "object" && !Array.isArray(b[k])) out[k] = mergeObj(out[k], b[k]);
    else out[k] = b[k];
  });
  return out;
}

// ===============================
// BRANDING + PROGRAMS + FIXED LEVEL
// ===============================
async function loadRemoteConfig(formType) {
  // Returns { branding, programs, fixed_level } or null
  try {
    const payload = isPublicMode()
      ? { token, form_type: formType }
      : { collection_id: cidParam, form_type: formType };

    const action = isPublicMode() ? "public_get_config" : "admin_get_config";
    const res = await apiCall(action, payload);
    return res && (res.config || res.data || res);
  } catch (e) {
    if (debug) console.log("config load failed", e);
    return null;
  }
}

function applyBrandingFromConfig(cfg, formType, fallbackTitle, fallbackSubtitle, fallbackTagline, defaultIconId) {
  // Robust: supports legacy cfg.branding.* as well as new cfg.settings/defaults/forms shape
  const root = (cfg && (cfg.settings || cfg.config || cfg)) || {};
  const defaultsNode = (root.defaults || (root.settings && root.settings.defaults) || {}) || {};
  const formsNode = (root.forms || (root.settings && root.settings.forms) || {}) || {};

  const ftKey = formType || "";
  const ftAliasA = ftKey.replace(/_form$/, "");
  const ftAliasB = (typeof FORM_TYPE_ALIAS !== "undefined" && FORM_TYPE_ALIAS) ? FORM_TYPE_ALIAS : "";
  const perForm = (formsNode[ftKey] || formsNode[ftAliasB] || formsNode[ftAliasA] || {}) || {};

  // Legacy branding locations
  const legacyGlobal = (root.branding && root.branding.global) ? root.branding.global : {};
  const legacyPerForm = (root.branding && root.branding.forms && root.branding.forms[ftKey]) ? root.branding.forms[ftKey] : {};

  // Merge priority: defaults -> perForm -> legacyGlobal -> legacyPerForm (per-form wins)
  const brand = mergeObj(mergeObj(mergeObj(defaultsNode, perForm), legacyGlobal), legacyPerForm);

  const title = brand.title || fallbackTitle || "EventLens Form";
  const subtitle = brand.subtitle || fallbackSubtitle || "";
  const tagline = brand.tagline || fallbackTagline || "";

  const footerText = brand.footer_text || "";

  // URLs: try common keys (lambda uses *_url; older uses *_image_url)
  const logoUrl = brand.logo_url || (brand.logo && brand.logo.url) || "";
  const headerUrl = brand.header_url || brand.header_image_url || (brand.header && brand.header.url) || "";
  const bgUrl = brand.background_url || brand.background_image_url || (brand.background && brand.background.url) || "";

  if ($("org-name")) $("org-name").textContent = title;
  if ($("org-subtitle")) $("org-subtitle").textContent = subtitle;
  if ($("org-tagline")) $("org-tagline").textContent = tagline;
  if ($("footer-text")) $("footer-text").textContent = footerText;

  // Theme
  setThemeVars(brand.theme_primary, brand.theme_secondary);
  setBackgroundImage(bgUrl);

  // Logo (preload to avoid ORB showing broken images)
  if (logoUrl && $("custom-logo")) {
    const img = new Image();
    img.onload = function() {
      $("custom-logo").src = logoUrl;
      $("custom-logo").classList.remove("hidden");
      if (defaultIconId && $(defaultIconId)) $(defaultIconId).classList.add("hidden");
    };
    img.onerror = function() {
      // keep default icon
    };
    img.src = logoUrl;
  }

  // Header image: support both <img> and div background
  if (headerUrl && $("header-image")) {
    const h = $("header-image");
    const img = new Image();
    img.onload = function() {
      if (h.tagName && h.tagName.toLowerCase() === "img") {
        h.src = headerUrl;
      } else {
        h.style.backgroundImage = "url('" + headerUrl + "')";
      }
      h.classList.remove("hidden");
    };
    img.onerror = function() {};
    img.src = headerUrl;
  }
}

function fillProgramNames(cfg, selectId) {
  const sel = $(selectId);
  if (!sel) return;

  // Collect programs from multiple possible shapes (new + legacy)
  const formsNode = (cfg && (cfg.forms || (cfg.settings && cfg.settings.forms) || (cfg.config && cfg.config.forms))) || {};
  const defaultsNode = (cfg && (cfg.defaults || (cfg.settings && cfg.settings.defaults) || (cfg.config && cfg.config.defaults))) || {};
  const ftNode = (formsNode && (formsNode[FORM_TYPE] || formsNode[FORM_TYPE_ALIAS] || formsNode[FORM_TYPE.replace(/_form$/,'')] )) || {};

  const arrs = [];
  if (Array.isArray(ftNode.program_options)) arrs.push(ftNode.program_options);
  if (Array.isArray(ftNode.programs)) arrs.push(ftNode.programs);
  if (Array.isArray(defaultsNode.programs)) arrs.push(defaultsNode.programs);
  if (Array.isArray(cfg.programs)) arrs.push(cfg.programs);

  const programs = Array.from(new Set(arrs.flat().map(s => safeStr(s).trim()).filter(Boolean)));

  sel.innerHTML = '<option value="">‚Äî ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ö‡•Å‡§®‡•á‡§Ç ‚Äî</option>';

  if (!programs.length) {
    const opt = document.createElement("option");
    opt.value = "";
    opt.textContent = "Admin ‡§Æ‡•á‡§Ç Program add ‡§ï‡§∞‡•á‡§Ç (‡§Ø‡§æ typing allowed)";
    sel.appendChild(opt);
    // allow manual typing fallback if present
    const manual = $("program_name_manual");
    if (manual) manual.classList.remove("hidden");
    return;
  }

  programs.forEach((v) => {
    const opt = document.createElement("option");
    opt.value = v;
    opt.textContent = v;
    sel.appendChild(opt);
  });

  const manual = $("program_name_manual");
  if (manual) manual.classList.add("hidden");
}

function getFixedLevel(cfg, formType) {
  const fixed = (cfg && cfg.fixed_levels) ? cfg.fixed_levels : (cfg && cfg.data && cfg.data.fixed_levels) ? cfg.data.fixed_levels : {};
  if (fixed && fixed[formType]) return String(fixed[formType]).toLowerCase();
  return "";
}
    const FORM_TYPE = "program_info";
    const FIELD_IDS = ["level","program_name","district","vidhansabha","mandal","program_date","program_time","venue","details"];

    const DISTRICT_DATA = {
"‡§Æ‡§Ç‡§¶‡§∏‡•å‡§∞": {
    "‡§Æ‡§Ç‡§¶‡§∏‡•å‡§∞": ["‡§Æ‡§Ç‡§¶‡§∏‡•å‡§∞ ‡§®‡§ó‡§∞ ‡§â‡§§‡•ç‡§§‡§∞", "‡§Æ‡§Ç‡§¶‡§∏‡•å‡§∞ ‡§®‡§ó‡§∞ ‡§¶‡§ï‡•ç‡§∑‡§ø‡§£", "‡§Æ‡§Ç‡§¶‡§∏‡•å‡§∞ ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£"],
    "‡§∏‡•Å‡§µ‡§æ‡§∏‡§∞‡§æ": ["‡§∏‡•Ä‡§§‡§æ‡§Æ‡§ä", "‡§∏‡•Å‡§µ‡§æ‡§∏‡§∞‡§æ", "‡§∂‡§æ‡§Æ‡§ó‡•ù"],
    "‡§ó‡§∞‡•ã‡§†": ["‡§ó‡§∞‡•ã‡§†", "‡§≠‡§æ‡§®‡§™‡•Å‡§∞‡§æ", "‡§Æ‡•á‡§≤‡§ñ‡•á‡•ú‡§æ"],
    "‡§Æ‡§≤‡•ç‡§π‡§æ‡§∞‡§ó‡•ù": ["‡§Æ‡§≤‡•ç‡§π‡§æ‡§∞‡§ó‡•ù", "‡§®‡§æ‡§∞‡§æ‡§Ø‡§£‡§ó‡•ù", "‡§™‡§ø‡§™‡§≤‡§ø‡§Ø‡§æ‡§Æ‡§Ç‡§°‡•Ä"]
},
"‡§∞‡§§‡§≤‡§æ‡§Æ": {
    "‡§∞‡§§‡§≤‡§æ‡§Æ ‡§∏‡§ø‡§ü‡•Ä": ["‡§¶‡•Ä‡§®‡§¶‡§Ø‡§æ‡§≤ ‡§®‡§ó‡§∞", "‡§Ö‡§Æ‡•ç‡§¨‡•á‡§°‡§ï‡§∞ ‡§®‡§ó‡§∞", "‡§∂‡•ç‡§Ø‡§æ‡§Æ‡§æ ‡§™‡•ç‡§∞‡§∏‡§æ‡§¶ ‡§Æ‡•Å‡§ñ‡§∞‡•ç‡§ú‡•Ä ‡§®‡§ó‡§∞"],
    "‡§∞‡§§‡§≤‡§æ‡§Æ ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£": ["‡§ß‡§∞‡§æ‡•ú", "‡§¨‡§æ‡§Ç‡§ó‡§∞‡•ã‡§¶", "‡§®‡§æ‡§Æ‡§≤‡•Ä"],
    "‡§∏‡•à‡§≤‡§æ‡§®‡§æ": ["‡§∏‡•à‡§≤‡§æ‡§®‡§æ", "‡§¨‡§æ‡§ú‡§®‡§æ", "‡§∞‡§æ‡§µ‡§ü‡•Ä"],
    "‡§ú‡§æ‡§µ‡§∞‡§æ": ["‡§ú‡§æ‡§µ‡§∞‡§æ ‡§®‡§ó‡§∞", "‡§ú‡§æ‡§µ‡§∞‡§æ ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£", "‡§™‡§ø‡§™‡•ç‡§≤‡•å‡§¶‡§æ"],
    "‡§Ü‡§≤‡•ã‡§ü": ["‡§Ü‡§≤‡•ã‡§ü", "‡§¨‡•ú‡§æ‡§µ‡§¶‡§æ", "‡§§‡§æ‡§≤"]
},
"‡§®‡•Ä‡§Æ‡§ö": {
    "‡§®‡•Ä‡§Æ‡§ö": ["‡§®‡•Ä‡§Æ‡§ö ‡§â‡§§‡•ç‡§§‡§∞", "‡§®‡•Ä‡§Æ‡§ö ‡§¶‡§ï‡•ç‡§∑‡§ø‡§£", "‡§®‡•Ä‡§Æ‡§ö ‡§™‡§∂‡•ç‡§ö‡§ø‡§Æ", "‡§ú‡•Ä‡§∞‡§®"],
    "‡§Æ‡§®‡§æ‡§∏‡§æ": ["‡§Æ‡§®‡§æ‡§∏‡§æ", "‡§∞‡§æ‡§Æ‡§™‡•Å‡§∞‡§æ", "‡§ï‡•Å‡§ï‡§æ‡•ú‡•á‡§∂‡•ç‡§µ‡§∞"],
    "‡§ú‡§æ‡§µ‡§¶": ["‡§ú‡§æ‡§µ‡§¶", "‡§∏‡§ø‡§Ç‡§ó‡•ã‡§≤‡•Ä", "‡§∞‡§§‡§®‡§ó‡•ù"]
},
"‡§â‡§ú‡•ç‡§ú‡•à‡§®": {
    "‡§â‡§ú‡•ç‡§ú‡•à‡§® ‡§â‡§§‡•ç‡§§‡§∞": ["‡§¶‡•å‡§≤‡§§‡§ó‡§Ç‡§ú", "‡§®‡§à ‡§∏‡•ú‡§ï", "‡§´‡•ç‡§∞‡•Ä‡§ó‡§Ç‡§ú"],
    "‡§â‡§ú‡•ç‡§ú‡•à‡§® ‡§¶‡§ï‡•ç‡§∑‡§ø‡§£": ["‡§Æ‡§π‡§æ‡§®‡§Ç‡§¶‡§æ", "‡§®‡§æ‡§®‡§æ‡§ñ‡•á‡•ú‡§æ", "‡§ï‡•ã‡§†‡•Ä ‡§∞‡•ã‡§°"],
    "‡§ò‡§ü‡•ç‡§ü‡§ø‡§Ø‡§æ": ["‡§ò‡§ü‡•ç‡§ü‡§ø‡§Ø‡§æ", "‡§â‡§®‡•ç‡§π‡•á‡§≤", "‡§™‡§æ‡§®‡§¨‡§ø‡§π‡§æ‡§∞"],
    "‡§§‡§∞‡§æ‡§®‡§æ": ["‡§§‡§∞‡§æ‡§®‡§æ", "‡§Æ‡§æ‡§ï‡•ú‡•ã‡§®", "‡§ï‡§æ‡§Ø‡§•‡§æ"],
    "‡§Æ‡§π‡§ø‡§¶‡§™‡•Å‡§∞": ["‡§Æ‡§π‡§ø‡§¶‡§™‡•Å‡§∞ ‡§®‡§ó‡§∞", "‡§Æ‡§π‡§ø‡§¶‡§™‡•Å‡§∞ ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£", "‡§ù‡§æ‡§∞‡•ú‡§æ"],
    "‡§®‡§æ‡§ó‡§¶‡§æ-‡§ñ‡§æ‡§ö‡§∞‡•å‡§¶": ["‡§®‡§æ‡§ó‡§¶‡§æ", "‡§ñ‡§æ‡§ö‡§∞‡•å‡§¶", "‡§¨‡§ø‡§∞‡§≤‡§æ‡§ó‡•ç‡§∞‡§æ‡§Æ"],
    "‡§¨‡•ú‡§®‡§ó‡§∞": ["‡§¨‡•ú‡§®‡§ó‡§∞", "‡§á‡§Ç‡§ó‡•ã‡§∞‡§ø‡§Ø‡§æ", "‡§ñ‡§∞‡§∏‡•å‡§¶"]
},
"‡§Ü‡§ó‡§∞-‡§Æ‡§æ‡§≤‡§µ‡§æ": {
    "‡§Ü‡§ó‡§∞": ["‡§Ü‡§ó‡§∞ ‡§®‡§ó‡§∞", "‡§Ü‡§ó‡§∞ ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£", "‡§¨‡•ú‡•å‡§¶"],
    "‡§∏‡•Å‡§∏‡§®‡•á‡§∞": ["‡§∏‡•Å‡§∏‡§®‡•á‡§∞", "‡§®‡§≤‡§ñ‡•á‡•ú‡§æ", "‡§∏‡•ã‡§Ø‡§§"]
},
"‡§∂‡§æ‡§ú‡§æ‡§™‡•Å‡§∞": {
    "‡§∂‡§æ‡§ú‡§æ‡§™‡•Å‡§∞": ["‡§∂‡§æ‡§ú‡§æ‡§™‡•Å‡§∞ ‡§®‡§ó‡§∞", "‡§∂‡§æ‡§ú‡§æ‡§™‡•Å‡§∞ ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£", "‡§Æ‡•ã. ‡§¨‡•ú‡•ã‡§¶‡§ø‡§Ø‡§æ"],
    "‡§∂‡•Å‡§ú‡§æ‡§≤‡§™‡•Å‡§∞": ["‡§∂‡•Å‡§ú‡§æ‡§≤‡§™‡•Å‡§∞ ‡§Æ‡§Ç‡§°‡•Ä", "‡§∂‡•Å‡§ú‡§æ‡§≤‡§™‡•Å‡§∞ ‡§∏‡§ø‡§ü‡•Ä", "‡§Ö‡§ï‡•ã‡§¶‡§ø‡§Ø‡§æ"],
    "‡§ï‡§æ‡§≤‡§æ‡§™‡•Ä‡§™‡§≤": ["‡§ï‡§æ‡§≤‡§æ‡§™‡•Ä‡§™‡§≤", "‡§™‡•ã‡§≤‡§æ‡§Ø‡§ï‡§≤‡§æ‡§Ç", "‡§ñ‡•ã‡§ï‡§∞‡§æ‡§ï‡§≤‡§æ‡§Ç"]
},
"‡§¶‡•á‡§µ‡§æ‡§∏": {
    "‡§¶‡•á‡§µ‡§æ‡§∏": ["‡§¶‡•á‡§µ‡§æ‡§∏ ‡§â‡§§‡•ç‡§§‡§∞", "‡§¶‡•á‡§µ‡§æ‡§∏ ‡§¶‡§ï‡•ç‡§∑‡§ø‡§£", "‡§¶‡•á‡§µ‡§æ‡§∏ ‡§™‡§∂‡•ç‡§ö‡§ø‡§Æ"],
    "‡§∏‡•ã‡§®‡§ï‡§ö‡•ç‡§õ": ["‡§∏‡•ã‡§®‡§ï‡§ö‡•ç‡§õ", "‡§ü‡•ã‡§Ç‡§ï‡§ñ‡•Å‡§∞‡•ç‡§¶", "‡§™‡•Ä‡§™‡§≤‡§∞‡§æ‡§µ‡§æ‡§Ç"],
    "‡§π‡§æ‡§ü‡§™‡§ø‡§™‡§≤‡•ç‡§Ø‡§æ": ["‡§π‡§æ‡§ü‡§™‡§ø‡§™‡§≤‡•ç‡§Ø‡§æ", "‡§®‡•á‡§µ‡§∞‡•Ä", "‡§ï‡§∞‡§®‡§æ‡§µ‡§æ‡§¶"],
    "‡§ñ‡§æ‡§§‡•á‡§ó‡§æ‡§Ç‡§µ": ["‡§ñ‡§æ‡§§‡•á‡§ó‡§æ‡§Ç‡§µ", "‡§ï‡§®‡•ç‡§®‡•å‡§¶", "‡§π‡§∞‡§£‡§ó‡§æ‡§Ç‡§µ"],
    "‡§¨‡§æ‡§ó‡§≤‡•Ä": ["‡§¨‡§æ‡§ó‡§≤‡•Ä", "‡§â‡§¶‡§Ø‡§®‡§ó‡§∞", "‡§∏‡§§‡§µ‡§æ‡§∏"]
},
"‡§á‡§Ç‡§¶‡•å‡§∞": {
    "‡§á‡§Ç‡§¶‡•å‡§∞-1": ["‡§µ‡§æ‡§∞‡•ç‡§° 1-5", "‡§µ‡§æ‡§∞‡•ç‡§° 6-10", "‡§µ‡§æ‡§∞‡•ç‡§° 11-15"],
    "‡§á‡§Ç‡§¶‡•å‡§∞-2": ["‡§µ‡§æ‡§∞‡•ç‡§° 16-20", "‡§µ‡§æ‡§∞‡•ç‡§° 21-25", "‡§µ‡§æ‡§∞‡•ç‡§° 26-30"],
    "‡§á‡§Ç‡§¶‡•å‡§∞-3": ["‡§µ‡§æ‡§∞‡•ç‡§° 31-35", "‡§µ‡§æ‡§∞‡•ç‡§° 36-40", "‡§µ‡§æ‡§∞‡•ç‡§° 41-45"],
    "‡§á‡§Ç‡§¶‡•å‡§∞-4": ["‡§µ‡§æ‡§∞‡•ç‡§° 46-50", "‡§µ‡§æ‡§∞‡•ç‡§° 51-55", "‡§µ‡§æ‡§∞‡•ç‡§° 56-60"],
    "‡§á‡§Ç‡§¶‡•å‡§∞-5": ["‡§µ‡§æ‡§∞‡•ç‡§° 61-65", "‡§µ‡§æ‡§∞‡•ç‡§° 66-70", "‡§µ‡§æ‡§∞‡•ç‡§° 71-75"],
    "‡§∞‡§æ‡§ä": ["‡§∞‡§æ‡§ä ‡§®‡§ó‡§∞", "‡§§‡•á‡§ú‡§æ‡§ú‡•Ä ‡§®‡§ó‡§∞", "‡§¶‡§§‡•ç‡§§‡•å‡§¶‡§æ"],
    "‡§Æ‡§π‡•Ç": ["‡§Æ‡§π‡•Ç ‡§®‡§ó‡§∞", "‡§Æ‡§π‡•Ç ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£", "‡§Æ‡§æ‡§®‡§™‡•Å‡§∞"],
    "‡§¶‡•á‡§™‡§æ‡§≤‡§™‡•Å‡§∞": ["‡§¶‡•á‡§™‡§æ‡§≤‡§™‡•Å‡§∞", "‡§ó‡•å‡§§‡§Æ‡§™‡•Å‡§∞‡§æ", "‡§¨‡•á‡§ü‡§Æ‡§æ"],
    "‡§∏‡§æ‡§Ç‡§µ‡•á‡§∞": ["‡§∏‡§æ‡§Ç‡§µ‡•á‡§∞", "‡§ö‡§Ç‡§¶‡•ç‡§∞‡§æ‡§µ‡§§‡•Ä‡§ó‡§Ç‡§ú", "‡§ï‡•ç‡§∑‡§ø‡§™‡•ç‡§∞‡§æ"]
},
"‡§ß‡§æ‡§∞": {
    "‡§ß‡§æ‡§∞": ["‡§ß‡§æ‡§∞ ‡§®‡§ó‡§∞", "‡§ß‡§æ‡§∞ ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£", "‡§§‡§ø‡§∞‡§≤‡§æ"],
    "‡§™‡•Ä‡§•‡§Æ‡§™‡•Å‡§∞": ["‡§™‡•Ä‡§•‡§Æ‡§™‡•Å‡§∞", "‡§∏‡§æ‡§ó‡•å‡§∞", "‡§®‡§æ‡§≤‡§õ‡§æ"],
    "‡§¨‡§¶‡§®‡§æ‡§µ‡§∞": ["‡§¨‡§¶‡§®‡§æ‡§µ‡§∞", "‡§ï‡§æ‡§®‡§µ‡§®", "‡§Æ‡•Å‡§≤‡§•‡§æ‡§®"],
    "‡§∏‡§∞‡§¶‡§æ‡§∞‡§™‡•Å‡§∞": ["‡§∏‡§∞‡§¶‡§æ‡§∞‡§™‡•Å‡§∞", "‡§∞‡§æ‡§ú‡§ó‡•ù", "‡§Ö‡§Æ‡§ù‡•á‡§∞‡§æ"],
    "‡§ó‡§Ç‡§ß‡§µ‡§æ‡§®‡•Ä": ["‡§ó‡§Ç‡§ß‡§µ‡§æ‡§®‡•Ä", "‡§¨‡§æ‡§ó", "‡§ü‡§æ‡§Ç‡§°‡§æ"],
    "‡§ï‡•Å‡§ï‡•ç‡§∑‡•Ä": ["‡§ï‡•Å‡§ï‡•ç‡§∑‡•Ä", "‡§°‡§π‡•Ä", "‡§®‡§ø‡§∏‡§∞‡§™‡•Å‡§∞"],
    "‡§Æ‡§®‡§æ‡§µ‡§∞": ["‡§Æ‡§®‡§æ‡§µ‡§∞", "‡§â‡§Æ‡§∞‡§¨‡§®", "‡§∏‡§ø‡§Ç‡§ò‡§æ‡§®‡§æ"],
    "‡§ß‡§∞‡§Æ‡§™‡•Å‡§∞‡•Ä": ["‡§ß‡§∞‡§Æ‡§™‡•Å‡§∞‡•Ä", "‡§ß‡§æ‡§Æ‡§®‡•ã‡§¶", "‡§Æ‡§æ‡§Ç‡§°‡•Ç"]
},
"‡§ù‡§æ‡§¨‡•Å‡§Ü": {
    "‡§ù‡§æ‡§¨‡•Å‡§Ü": ["‡§ù‡§æ‡§¨‡•Å‡§Ü ‡§®‡§ó‡§∞", "‡§ù‡§æ‡§¨‡•Å‡§Ü ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£", "‡§∞‡§æ‡§Æ‡§æ"],
    "‡§•‡§æ‡§Ç‡§¶‡§≤‡§æ": ["‡§•‡§æ‡§Ç‡§¶‡§≤‡§æ", "‡§ñ‡§µ‡§æ‡§∏‡§æ", "‡§Æ‡•á‡§ò‡§®‡§ó‡§∞"],
    "‡§™‡•á‡§ü‡§≤‡§æ‡§µ‡§¶": ["‡§™‡•á‡§ü‡§≤‡§æ‡§µ‡§¶", "‡§∞‡§æ‡§Ø‡§™‡•Å‡§∞‡§ø‡§Ø‡§æ", "‡§∏‡§æ‡§∞‡§Ç‡§ó‡•Ä"]
},
"‡§Ö‡§≤‡•Ä‡§∞‡§æ‡§ú‡§™‡•Å‡§∞": {
    "‡§Ö‡§≤‡•Ä‡§∞‡§æ‡§ú‡§™‡•Å‡§∞": ["‡§Ö‡§≤‡•Ä‡§∞‡§æ‡§ú‡§™‡•Å‡§∞ ‡§®‡§ó‡§∞", "‡§Ö‡§≤‡•Ä‡§∞‡§æ‡§ú‡§™‡•Å‡§∞ ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£", "‡§∏‡•ã‡§Ç‡§°‡§µ‡§æ"],
    "‡§ú‡•ã‡§¨‡§ü": ["‡§ú‡•ã‡§¨‡§ü", "‡§â‡§¶‡§Ø‡§ó‡•ù", "‡§≠‡§æ‡§¨‡§∞‡§æ"]
},
"‡§ñ‡§∞‡§ó‡•ã‡§®": {
    "‡§ñ‡§∞‡§ó‡•ã‡§®": ["‡§ñ‡§∞‡§ó‡•ã‡§® ‡§®‡§ó‡§∞", "‡§ñ‡§∞‡§ó‡•ã‡§® ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£", "‡§∏‡§®‡§æ‡§µ‡§¶"],
    "‡§≠‡•Ä‡§ï‡§®‡§ó‡§æ‡§Ç‡§µ": ["‡§≠‡•Ä‡§ï‡§®‡§ó‡§æ‡§Ç‡§µ", "‡§ù‡§ø‡§∞‡§®‡•ç‡§Ø‡§æ", "‡§ó‡•ã‡§ó‡§æ‡§µ‡§æ‡§Ç"],
    "‡§¨‡•ú‡§µ‡§æ‡§π": ["‡§¨‡•ú‡§µ‡§æ‡§π", "‡§Æ‡§π‡•á‡§∂‡•ç‡§µ‡§∞", "‡§ï‡§∞‡§π‡•Ä"],
    "‡§Æ‡§π‡•á‡§∂‡•ç‡§µ‡§∞": ["‡§Æ‡§π‡•á‡§∂‡•ç‡§µ‡§∞", "‡§Æ‡§Ç‡§°‡§≤‡•á‡§∂‡•ç‡§µ‡§∞", "‡§ß‡§æ‡§Æ‡§®‡•ã‡§¶"],
    "‡§ï‡§∏‡§∞‡§æ‡§µ‡§¶": ["‡§ï‡§∏‡§∞‡§æ‡§µ‡§¶", "‡§™‡§ø‡§™‡§≤‡§ó‡•ã‡§®", "‡§¨‡§æ‡§≤‡§ï‡§µ‡§æ‡•ú‡§æ"],
    "‡§≠‡§ó‡§µ‡§æ‡§®‡§™‡•Å‡§∞‡§æ": ["‡§≠‡§ó‡§µ‡§æ‡§®‡§™‡•Å‡§∞‡§æ", "‡§∏‡•á‡§ó‡§æ‡§Ç‡§µ", "‡§¨‡§ø‡§∏‡•ç‡§ü‡§æ‡§®"]
},
"‡§¨‡•ú‡§µ‡§æ‡§®‡•Ä": {
    "‡§¨‡•ú‡§µ‡§æ‡§®‡•Ä": ["‡§¨‡•ú‡§µ‡§æ‡§®‡•Ä ‡§®‡§ó‡§∞", "‡§¨‡•ú‡§µ‡§æ‡§®‡•Ä ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£", "‡§™‡§æ‡§ü‡•Ä"],
    "‡§∏‡•á‡§Ç‡§ß‡§µ‡§æ": ["‡§∏‡•á‡§Ç‡§ß‡§µ‡§æ ‡§®‡§ó‡§∞", "‡§∏‡•á‡§Ç‡§ß‡§µ‡§æ ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£", "‡§ö‡§æ‡§ö‡§∞‡•Ä‡§Ø‡§æ"],
    "‡§∞‡§æ‡§ú‡§™‡•Å‡§∞": ["‡§∞‡§æ‡§ú‡§™‡•Å‡§∞", "‡§†‡•Ä‡§ï‡§∞‡•Ä", "‡§Ö‡§Ç‡§ú‡•ú"],
    "‡§™‡§æ‡§®‡§∏‡•á‡§Æ‡§≤": ["‡§™‡§æ‡§®‡§∏‡•á‡§Æ‡§≤", "‡§ñ‡•á‡§§‡§ø‡§Ø‡§æ", "‡§®‡§ø‡§µ‡§æ‡§≤‡•Ä"]
},
"‡§ñ‡§Ç‡§°‡§µ‡§æ": {
    "‡§ñ‡§Ç‡§°‡§µ‡§æ": ["‡§ñ‡§Ç‡§°‡§µ‡§æ ‡§®‡§ó‡§∞", "‡§ñ‡§Ç‡§°‡§µ‡§æ ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£", "‡§õ‡•à‡§ó‡§æ‡§Ç‡§µ‡§Æ‡§æ‡§ñ‡§®"],
    "‡§™‡§Ç‡§ß‡§æ‡§®‡§æ": ["‡§™‡§Ç‡§ß‡§æ‡§®‡§æ", "‡§∏‡§ø‡§Ç‡§ò‡•ã‡§ü", "‡§Ü‡§∞‡•Å‡§¶"],
    "‡§Æ‡§æ‡§Ç‡§ß‡§æ‡§§‡§æ": ["‡§Æ‡§æ‡§Ç‡§ß‡§æ‡§§‡§æ", "‡§™‡•Å‡§®‡§æ‡§∏‡§æ", "‡§Æ‡•Ç‡§Ç‡§¶‡•Ä"],
    "‡§π‡§∞‡§∏‡•Ç‡§¶": ["‡§π‡§∞‡§∏‡•Ç‡§¶", "‡§ñ‡§æ‡§≤‡§µ‡§æ", "‡§ï‡§ø‡§≤‡•ç‡§≤‡•ã‡§¶"]
},
"‡§¨‡•Å‡§∞‡§π‡§æ‡§®‡§™‡•Å‡§∞": {
    "‡§¨‡•Å‡§∞‡§π‡§æ‡§®‡§™‡•Å‡§∞": ["‡§¨‡•Å‡§∞‡§π‡§æ‡§®‡§™‡•Å‡§∞ ‡§®‡§ó‡§∞", "‡§¨‡•Å‡§∞‡§π‡§æ‡§®‡§™‡•Å‡§∞ ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£", "‡§∂‡§æ‡§π‡§™‡•Å‡§∞"],
    "‡§®‡•á‡§™‡§æ‡§®‡§ó‡§∞": ["‡§®‡•á‡§™‡§æ‡§®‡§ó‡§∞", "‡§ß‡•Å‡§≤‡§ï‡•ã‡§ü", "‡§ñ‡§ï‡§®‡§æ‡§∞"]
}
};
    // ===============================
// LOCATION HELPERS (district -> vidhansabha -> mandal)
// ===============================
function initDistrictCascade() {
  const dEl = $("district");
  const vEl = $("vidhansabha");
  const mEl = $("mandal");
  if (!dEl || !vEl || !mEl) return;

  // Populate Districts
  dEl.innerHTML = '<option value="">‚Äî ‡§ú‡§ø‡§≤‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç ‚Äî</option>';
  Object.keys(DISTRICT_DATA).sort((a,b)=>a.localeCompare(b,"hi")).forEach((d) => {
    const opt = document.createElement("option");
    opt.value = d;
    opt.textContent = d;
    dEl.appendChild(opt);
  });

  dEl.addEventListener("change", () => {
    const dVal = dEl.value;
    vEl.innerHTML = '<option value="">‚Äî ‡§µ‡§ø‡§ß‡§æ‡§®‡§∏‡§≠‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç ‚Äî</option>';
    mEl.innerHTML = '<option value="">‚Äî ‡§™‡§π‡§≤‡•á ‡§µ‡§ø‡§ß‡§æ‡§®‡§∏‡§≠‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç ‚Äî</option>';
    vEl.disabled = !dVal;
    mEl.disabled = true;

    if (dVal && DISTRICT_DATA[dVal]) {
      Object.keys(DISTRICT_DATA[dVal]).sort((a,b)=>a.localeCompare(b,"hi")).forEach((v) => {
        const opt = document.createElement("option");
        opt.value = v;
        opt.textContent = v;
        vEl.appendChild(opt);
      });
    }
  });

  vEl.addEventListener("change", () => {
    const dVal = dEl.value;
    const vVal = vEl.value;
    mEl.innerHTML = '<option value="">‚Äî ‡§Æ‡§Ç‡§°‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç ‚Äî</option>';
    mEl.disabled = !vVal;

    if (dVal && vVal && DISTRICT_DATA[dVal] && DISTRICT_DATA[dVal][vVal]) {
      DISTRICT_DATA[dVal][vVal].slice().sort((a,b)=>a.localeCompare(b,"hi")).forEach((m) => {
        const opt = document.createElement("option");
        opt.value = m;
        opt.textContent = m;
        mEl.appendChild(opt);
      });
    }
  });
}

function applyLocationAutofill(info) {
  // info: {district, vidhansabha, mandal}
  if (!info) return;
  const d = safeStr(info.district).trim();
  const v = safeStr(info.vidhansabha).trim();
  const m = safeStr(info.mandal).trim();

  if (d && $("district")) {
    $("district").value = d;
    $("district").dispatchEvent(new Event("change"));
    setTimeout(() => {
      if (v && $("vidhansabha")) {
        $("vidhansabha").value = v;
        $("vidhansabha").dispatchEvent(new Event("change"));
        setTimeout(() => {
          if (m && $("mandal")) $("mandal").value = m;
        }, 120);
      }
    }, 120);
  }
}
    // ===============================
// LEVEL (optional fixed)
// ===============================
const LEVELS = ["district","vidhansabha","mandal"];

function setLocationVisibility(level) {
  const dWrap = $("wrap-district");
  const vWrap = $("wrap-vidhansabha");
  const mWrap = $("wrap-mandal");
  if (!dWrap || !vWrap || !mWrap) return;
  // Always show all three dropdowns; we only disable based on selection.
  dWrap.classList.remove("hidden");
  vWrap.classList.remove("hidden");
  mWrap.classList.remove("hidden");
}

function initLevelControl(cfg, formType) {
  const levelEl = $("level");
  if (!levelEl) return;

  // decide fixed: url param > config fixed > none
  const fixedFromCfg = getFixedLevel(cfg, formType);
  const fixed = (LEVELS.includes(levelParam) ? levelParam : "") || (LEVELS.includes(fixedFromCfg) ? fixedFromCfg : "");

  if (fixed) {
    levelEl.value = fixed;
    levelEl.disabled = true;
    if ($("level-note")) $("level-note").textContent = "Level locked: " + fixed;
  } else {
    levelEl.disabled = false;
    if ($("level-note")) $("level-note").textContent = "Level: ‡§Ü‡§™ ‡§¨‡§¶‡§≤ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç";
  }

  setLocationVisibility(levelEl.value);

  levelEl.addEventListener("change", () => {
    setLocationVisibility(levelEl.value);
  });
}
    // ===============================
// MULTI-PHOTO (optional)
// ===============================
let selectedFiles = [];

function refreshPhotoUI() {
  const grid = $("photo-grid");
  const hint = $("photo-hint");
  if (!grid) return;

  grid.innerHTML = "";
  if (!selectedFiles.length) {
    if (hint) hint.classList.remove("hidden");
    return;
  }
  if (hint) hint.classList.add("hidden");

  selectedFiles.forEach((f, idx) => {
    const url = URL.createObjectURL(f);
    const card = document.createElement("div");
    card.className = "relative overflow-hidden rounded-xl border border-white/10 bg-white/5";
    const img = document.createElement("img");
    img.src = url; img.className = "w-full h-24 object-cover"; img.alt = "photo-" + idx;
    const btn = document.createElement("button");
    btn.type = "button"; btn.className = "absolute top-2 right-2 bg-black/60 hover:bg-black/70 text-white rounded-full w-7 h-7 flex items-center justify-center border border-white/10";
    btn.innerHTML = '<i class="fa-solid fa-xmark text-xs"></i>';
    card.appendChild(img); card.appendChild(btn);
    btn.addEventListener("click", () => {
      selectedFiles.splice(idx, 1);
      refreshPhotoUI();
    });
    grid.appendChild(card);
  });
}

function onPhotosSelected(ev, maxFiles=10) {
  const files = Array.from((ev.target.files || []));
  if (!files.length) return;

  const next = selectedFiles.concat(files);
  selectedFiles = next.slice(0, maxFiles);
  $("photos").value = "";
  refreshPhotoUI();
}

    let remoteCfg = null;

    async function initAll() {
      initDistrictCascade();

      remoteCfg = await loadRemoteConfig(FORM_TYPE);
      applyBrandingFromConfig(remoteCfg, FORM_TYPE, "‡§™‡•ç‡§∞‡•ã‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§á‡§®‡•ç‡§´‡•ã", "Program Information", "", "default-icon");
      // === Admin Console iframe live preview fallback snapshot (2026-02-17)
      try {
        window.__EL_PREVIEW_FALLBACKS = {
          title: (document.getElementById("org-name")?.textContent || "").trim(),
          subtitle: (document.getElementById("org-subtitle")?.textContent || "").trim(),
          tagline: (document.getElementById("org-tagline")?.textContent || "").trim(),
          iconId: "default-icon"
        };
      } catch(e) {}



      if ($("org-tagline") && $("org-tagline").textContent.trim()) $("org-tagline").classList.remove("hidden");
      if ($("footer-text") && $("footer-text").textContent.trim() === "") $("footer-text").textContent = "Powered by EventLens";

      fillProgramNames(remoteCfg, "program_name");
      initLevelControl(remoteCfg, FORM_TYPE);

      // Photo upload removed - no file event listeners needed
      refreshPhotoUI();
    }

    document.addEventListener("DOMContentLoaded", initAll);

    function validateLocation(level, data) {
      if (level === "district") {
        if (!data.district) throw new Error("‡§ï‡•É‡§™‡§Ø‡§æ ‡§ú‡§ø‡§≤‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç");
      } else if (level === "vidhansabha") {
        if (!data.district) throw new Error("‡§ï‡•É‡§™‡§Ø‡§æ ‡§ú‡§ø‡§≤‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç");
        if (!data.vidhansabha) throw new Error("‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§ø‡§ß‡§æ‡§®‡§∏‡§≠‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç");
      } else {
        if (!data.district) throw new Error("‡§ï‡•É‡§™‡§Ø‡§æ ‡§ú‡§ø‡§≤‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç");
        if (!data.vidhansabha) throw new Error("‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§ø‡§ß‡§æ‡§®‡§∏‡§≠‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç");
        if (!data.mandal) throw new Error("‡§ï‡•É‡§™‡§Ø‡§æ ‡§Æ‡§Ç‡§°‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç");
      }
    }

    async function submitWithFiles(data) {
      // Photo upload removed - always submit without files
      const res = isPublicMode()
        ? await apiCall("public_create_entry", { token, form_type: FORM_TYPE, no_photo: true, payload: data })
        : await apiCall("create_entry", { collection_id: cidParam, form_type: FORM_TYPE, no_photo: true, payload: data });

      const finalizeAction = isPublicMode() ? "public_finalize_entry" : "finalize_entry";
      await apiCall(finalizeAction, { finalize_token: res.finalize_token, entry_id: res.entry_id });
      return;
    }

    $("f").addEventListener("submit", async (e) => {
      e.preventDefault();
        if (typeof __EL_PREVIEW_MODE !== "undefined" && __EL_PREVIEW_MODE) {
          try { showStatus("üîé Preview Mode: submit disabled", false); } catch(e) {}
          return;
        }

      const btn = $("submitBtn");
      const old = btn.innerHTML;
      btn.disabled = true;
      btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Processing...';
      showStatus("", false);

      try {
        const data = {};
        FIELD_IDS.forEach((id) => {
          const el = $(id);
          if (el) data[id] = (el.value || "").trim();
        });

        if (!data.program_name) throw new Error("‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ö‡•Å‡§®‡•á‡§Ç");
        if (!data.program_date) throw new Error("‡§ï‡•É‡§™‡§Ø‡§æ ‡§§‡§æ‡§∞‡•Ä‡§ñ ‡§ö‡•Å‡§®‡•á‡§Ç");
        if (!data.venue) throw new Error("‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡•ç‡§•‡§æ‡§® ‡§≠‡§∞‡•á‡§Ç");
        if (!data.details) throw new Error("‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§≤‡§ø‡§ñ‡•á‡§Ç");

        const level = (data.level || "mandal").toLowerCase();
        validateLocation(level, data);

        if (!isPublicMode() && !cidParam) throw new Error("Missing Collection ID (cid)");

        await submitWithFiles(data);

        $("main-container").classList.add("hidden");
        $("success-screen").classList.remove("hidden");
      } catch (err) {
        showStatus("‚ùå " + (err.message || "Error"), true);
        btn.disabled = false;
        btn.innerHTML = old;
      }
    });
    </script>

    </body>
    </html>
